<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="College Class Schedule & Notifications" />
  <meta name="theme-color" content="#2196F3" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 192 192'><rect fill='%232196F3' width='192' height='192'/><text x='50%' y='50%' font-size='100' fill='white' text-anchor='middle' dy='.3em'>üìö</text></svg>">
  <title>Class Schedule Calendar</title>

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container { max-width: 900px; margin: 0 auto; }

    header {
      background: white;
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      text-align: center;
    }

    h1 { color: #333; font-size: 28px; margin-bottom: 10px; }

    .calendar-container {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      gap: 10px;
      flex-wrap: wrap;
    }

    .calendar-header button {
      background: #2196F3;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: background 0.3s;
    }

    .calendar-header button:hover { background: #1976D2; }

    .month-year { font-size: 24px; font-weight: bold; color: #333; }

    .week-badge {
      display: inline-block;
      background: #f0f7ff;
      border: 1px solid #cfe3ff;
      color: #1f5aa6;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 700;
    }

    .weekdays {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      margin-bottom: 10px;
    }

    .weekday {
      text-align: center;
      font-weight: bold;
      color: #2196F3;
      padding: 10px 0;
      font-size: 14px;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      min-height: 600px;
    }

    .day-box {
      background: #f9f9f9;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 10px;
      min-height: 120px;
      cursor: pointer;
      transition: all 0.3s;
      position: relative;
    }

    .day-box:hover { background: #f0f7ff; border-color: #2196F3; }

    .day-box.other-month { background: #fafafa; opacity: 0.5; cursor: default; }

    .day-box.today { background: #e3f2fd; border-color: #2196F3; border-width: 3px; }

    .day-number { font-weight: bold; color: #333; margin-bottom: 8px; font-size: 16px; }

    .day-box.other-month .day-number { color: #999; }

    .class-event {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 4px 6px;
      border-radius: 4px;
      font-size: 11px;
      margin-bottom: 3px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-weight: 500;
    }

    .class-event.class1 { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .class-event.class5 { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }

    /* Holiday / closed day styling */
    .class-event.holiday {
      background: linear-gradient(135deg, #ffb347 0%, #ffcc33 100%);
      color: #333;
      font-weight: bold;
    }

    .info-box {
      background: #fff3cd;
      border: 1px solid #ffc107;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      color: #856404;
      text-align: center;
    }

    .notification-btn {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.3s;
      margin-top: 10px;
    }

    .notification-btn:hover { background: #45a049; }

    .next-class {
      background: #f0f7ff;
      border-left: 4px solid #2196F3;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      text-align: left;
    }

    .next-class h3 { color: #2196F3; margin-bottom: 10px; }

    .class-name { font-size: 18px; font-weight: bold; color: #333; }

    .class-details { color: #666; font-size: 14px; margin-top: 5px; }

    @media (max-width: 768px) {
      .container { max-width: 100%; }
      .calendar-grid { min-height: 800px; }
      .day-box { min-height: 100px; padding: 8px; }
      .day-number { font-size: 14px; }
      .class-event { font-size: 10px; }
      .weekday { font-size: 12px; }
      .month-year { font-size: 20px; }
    }

    @media (max-width: 480px) {
      .container { max-width: 100%; }
      .calendar-grid { min-height: 1000px; }
      .day-box { min-height: 80px; }
      h1 { font-size: 22px; }
    }
  </style>
</head>

<body>
  <div class="container">
    <header>
      <h1>üìö Class Schedule Calendar</h1>
      <button class="notification-btn" onclick="requestNotifications()">
        üîî Enable Notifications
      </button>

      <div class="next-class" id="nextClass">
        <h3>Next Class</h3>
        <p style="color:#666;">Loading...</p>
      </div>
    </header>

    <div class="info-box">
      ‚ÑπÔ∏è Click on any date to see class details. Ask your instructor if you are not sure in which class you are scheduled.
    </div>

    <div class="calendar-container">
      <div class="calendar-header">
        <button onclick="previousMonth()">‚Üê Previous</button>

        <div style="text-align:center; flex: 1;">
          <div class="month-year" id="monthYear"></div>
          <div class="week-badge" id="weekBadge">Week A</div>
        </div>

        <button onclick="nextMonth()">Next ‚Üí</button>
      </div>

      <div class="weekdays">
        <div class="weekday">Sun</div>
        <div class="weekday">Mon</div>
        <div class="weekday">Tue</div>
        <div class="weekday">Wed</div>
        <div class="weekday">Thu</div>
        <div class="weekday">Fri</div>
        <div class="weekday">Sat</div>
      </div>

      <div class="calendar-grid" id="calendarGrid"></div>
    </div>
  </div>

  <script>
    /**********************
     * CLASS TEMPLATES    *
     **********************/
    const classTemplate = {
      class1day: [
        { name: 'Class 1', time: '08:00 - 10:00', type: 'class1' },
        { name: 'Class 2', time: '10:00 - 12:00', type: 'class1' },
        { name: 'Class 3', time: '12:00 - 14:00', type: 'class1' },
        { name: 'Class 4', time: '14:00 - 16:00', type: 'class1' }
      ],
      class5day: [
        { name: 'Class 5', time: '08:00 - 10:00', type: 'class5' },
        { name: 'Class 6', time: '10:00 - 12:00', type: 'class5' },
        { name: 'Class 7', time: '12:00 - 14:00', type: 'class5' },
        { name: 'Class 8', time: '14:00 - 16:00', type: 'class5' }
      ],
      saturday: [
        { name: 'Saturday Classes', time: '09:00 - 13:00', type: 'class5' }
      ]
    };

    /*************************
     * HOLIDAYS / SPECIAL    *
     *************************/
    const publicHolidays = {
      '2026-01-01': "New Year's Day",
      '2026-03-21': "Human Rights Day",
      '2026-04-03': "Good Friday",
      '2026-04-04': "NCC Closed",
      '2026-04-06': "Family Day",
      '2026-04-27': "Freedom Day",
      '2026-05-01': "Workers' Day",
      '2026-05-30': "NCC Graduation Day",
      '2026-06-16': "Youth Day",
      '2026-07-04': "NCC Graduation Day",
      '2026-08-09': "National Women's Day",
      '2026-08-10': "Women's Day (Observed)",
      '2026-09-24': "Heritage Day",
      '2026-12-16': "Day of Reconciliation / NCC Closed Annual Holliday",
      '2026-12-17': "NCC Closed Annual Holliday",
      '2026-12-18': "NCC Closed Annual Holliday",
      '2026-12-19': "NCC Closed Annual Holliday",
      '2026-12-20': "NCC Closed Annual Holliday",
      '2026-12-21': "NCC Closed Annual Holliday",
      '2026-12-22': "NCC Closed Annual Holliday",
      '2026-12-23': "NCC Closed Annual Holliday",
      '2026-12-24': "NCC Closed Annual Holliday",
      '2026-12-25': "Christmas Day",
      '2026-12-26': "Day of Goodwill"
      '2026-12-27': "NCC Closed Annual Holliday",
      '2026-12-28': "NCC Closed Annual Holliday",
      '2026-12-29': "NCC Closed Annual Holliday",
      '2026-12-30': "NCC Closed Annual Holliday",
      '2026-12-31': "NCC Closed Annual Holliday",
      '2027-01-01': "New Year's Day",
      '2027-01-02': "NCC Closed Annual Holliday",
    };

    // No classes on these dates
    const noClassDates = new Set(Object.keys(publicHolidays));

    /*************************
     * WEEK ROTATION (A/B)   *
     *************************/
    // Anchor week: 16 Feb 2026 is "Week A"
    const rotationAnchor = '2026-02-16';

    function getMonday(d) {
      const date = new Date(d);
      const day = date.getDay(); // 0=Sun..6=Sat
      const diff = (day === 0 ? -6 : 1) - day; // shift to Monday
      date.setDate(date.getDate() + diff);
      date.setHours(0, 0, 0, 0);
      return date;
    }

    function weeksBetween(anchorStr, dateStr) {
      const anchorDate = getMonday(new Date(anchorStr + 'T00:00:00'));
      const targetDate = getMonday(new Date(dateStr + 'T00:00:00'));
      const msPerWeek = 7 * 24 * 60 * 60 * 1000;
      return Math.round((targetDate - anchorDate) / msPerWeek);
    }

    function getWeekLabel(dateStr) {
      const weekOffset = weeksBetween(rotationAnchor, dateStr);
      const isWeekA = (weekOffset % 2 === 0);
      return isWeekA ? 'Week A' : 'Week B';
    }

    /*************************
     * SCHEDULE GENERATOR    *
     *************************/
    function getClassesForDate(dateStr) {
      // Block classes on holidays/closures
      if (noClassDates.has(dateStr)) return [];

      const date = new Date(dateStr + 'T00:00:00');
      const day = date.getDay(); // 0=Sun..6=Sat

      // Sun: no classes
      if (day === 0) return [];

      // Sat: Saturday classes (no rotation)
      if (day === 6) return classTemplate.saturday;

      const weekOffset = weeksBetween(rotationAnchor, dateStr);
      const isWeekA = (weekOffset % 2 === 0);
      const isMonWedFri = (day === 1 || day === 3 || day === 5);

      // Week A:  Mon/Wed/Fri = Class 5, Tue/Thu = Class 1
      // Week B:  Mon/Wed/Fri = Class 1, Tue/Thu = Class 5
      if (isWeekA) {
        return isMonWedFri ? classTemplate.class5day : classTemplate.class1day;
      } else {
        return isMonWedFri ? classTemplate.class1day : classTemplate.class5day;
      }
    }

    /**********************
     * CALENDAR CONTROLS  *
     **********************/
    let currentMonth = 1; // 0=Jan
    let currentYear = 2026;

    function renderCalendar() {
      const calendarGrid = document.getElementById('calendarGrid');
      const monthYearDisplay = document.getElementById('monthYear');
      const weekBadge = document.getElementById('weekBadge');

      const monthNames = [
        'January', 'February', 'March', 'April', 'May', 'June',
        'July', 'August', 'September', 'October', 'November', 'December'
      ];
      monthYearDisplay.textContent = `${monthNames[currentMonth]} ${currentYear}`;

      const firstDay = new Date(currentYear, currentMonth, 1).getDay();
      const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
      const daysInPrevMonth = new Date(currentYear, currentMonth, 0).getDate();

      calendarGrid.innerHTML = '';

      // Set week badge based on the first day of the month (Monday of that week)
      const firstDateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-01`;
      weekBadge.textContent = getWeekLabel(firstDateStr);

      // Previous month filler
      for (let i = firstDay - 1; i >= 0; i--) {
        calendarGrid.appendChild(createDayBox(daysInPrevMonth - i, true));
      }

      // Current month
      for (let day = 1; day <= daysInMonth; day++) {
        const dateStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        calendarGrid.appendChild(createDayBox(day, false, dateStr));
      }

      // Next month filler up to 42 cells
      const remainingCells = 42 - calendarGrid.children.length;
      for (let day = 1; day <= remainingCells; day++) {
        calendarGrid.appendChild(createDayBox(day, true));
      }

      updateNextClass();
    }

    function createDayBox(day, isOtherMonth, dateStr = null) {
      const dayBox = document.createElement('div');
      dayBox.className = 'day-box';

      if (isOtherMonth) {
        dayBox.classList.add('other-month');
      }

      // Today highlight
      const today = new Date();
      if (!isOtherMonth && dateStr) {
        const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
        if (dateStr === todayStr) dayBox.classList.add('today');
      }

      const dayNumber = document.createElement('div');
      dayNumber.className = 'day-number';
      dayNumber.textContent = day;
      dayBox.appendChild(dayNumber);

      // Add class blocks
      if (dateStr) {
        const classes = getClassesForDate(dateStr);
        classes.forEach(cls => {
          const classEvent = document.createElement('div');
          classEvent.className = `class-event ${cls.type}`;
          classEvent.textContent = cls.name;
          classEvent.title = `${cls.name}\n${cls.time}`;
          dayBox.appendChild(classEvent);
        });

        // Add holiday/special-day label
        if (publicHolidays[dateStr]) {
          const holidayTag = document.createElement('div');
          holidayTag.className = 'class-event holiday';
          holidayTag.textContent = 'üéâ ' + publicHolidays[dateStr];
          holidayTag.title = publicHolidays[dateStr];
          dayBox.appendChild(holidayTag);
        }
      }

      // Click details (only for current month cells)
      if (!isOtherMonth && dateStr) {
        dayBox.onclick = () => showClassDetails(dateStr);
        dayBox.style.cursor = 'pointer';
      } else {
        dayBox.style.cursor = 'default';
      }

      return dayBox;
    }

    function previousMonth() {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      renderCalendar();
    }

    function nextMonth() {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar();
    }

    function showClassDetails(dateStr) {
      const classes = getClassesForDate(dateStr);
      const holidayName = publicHolidays[dateStr];
      const weekLabel = getWeekLabel(dateStr);

      if ((!classes || classes.length === 0) && !holidayName) return;

      const date = new Date(dateStr + 'T00:00:00');
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      const dateDisplay = date.toLocaleDateString('en-US', options);

      let details = `${dateDisplay}\n${weekLabel}\n\n`;

      if (holidayName) details += `üéâ ${holidayName}\n\n`;

      if (classes && classes.length > 0) {
        classes.forEach(cls => {
          details += `${cls.name}\n‚è∞ ${cls.time}\n\n`;
        });
      } else if (holidayName) {
        details += `No classes scheduled.\n\n`;
      }

      alert(details);
    }

    function updateNextClass() {
      const now = new Date();
      const currentHours = now.getHours();
      const currentMinutes = now.getMinutes();
      const currentTotalMinutes = currentHours * 60 + currentMinutes;

      let nextClass = null;
      let nextClassDate = null;

      // Look ahead up to 90 days for the next class
      for (let i = 0; i <= 90; i++) {
        const d = new Date(now);
        d.setDate(now.getDate() + i);
        const dateStr = d.toISOString().split('T')[0];
        const classes = getClassesForDate(dateStr);

        for (const cls of classes) {
          const [startTime] = cls.time.split(' - ');
          const [startHour, startMin] = startTime.split(':').map(Number);
          const classStartMinutes = startHour * 60 + startMin;

          if (i === 0) {
            if (classStartMinutes > currentTotalMinutes) {
              nextClass = cls;
              nextClassDate = dateStr;
              break;
            }
          } else {
            nextClass = cls;
            nextClassDate = dateStr;
            break;
          }
        }
        if (nextClass) break;
      }

      const nextClassDiv = document.getElementById('nextClass');

      if (nextClass) {
        const date = new Date(nextClassDate + 'T00:00:00');
        const options = { weekday: 'long', month: 'short', day: 'numeric' };
        const dateDisplay = date.toLocaleDateString('en-US', options);

        nextClassDiv.innerHTML = `
          <h3>Next Class</h3>
          <div class="class-name">${nextClass.name}</div>
          <div class="class-details">üìÖ ${dateDisplay} (${getWeekLabel(nextClassDate)})</div>
          <div class="class-details">‚è∞ ${nextClass.time}</div>
        `;
      } else {
        nextClassDiv.innerHTML = `
          <h3>Next Class</h3>
          <p style="color:#666;">No upcoming classes scheduled</p>
        `;
      }
    }

    function requestNotifications() {
      if (!('Notification' in window)) {
        alert('Your browser does not support notifications');
        return;
      }

      if (Notification.permission === 'granted') {
        alert('‚úÖ Notifications already enabled!');
        return;
      }

      if (Notification.permission === 'denied') {
        alert('‚ö†Ô∏è Notifications are blocked. Please enable them in your browser settings.');
        return;
      }

      Notification.requestPermission().then(permission => {
        if (permission === 'granted') {
          alert('‚úÖ Notifications enabled! (Note: permission only. Full reminders require a scheduler/service worker logic.)');
        }
      });
    }

    // Register Service Worker (optional)
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js')
        .then(() => console.log('Service Worker registered'))
        .catch(err => console.log('Service Worker registration failed:', err));
    }

    // Initialize
    renderCalendar();
  </script>
</body>
</html>
